import{d as C,r as w,u as e,a as O,b as P,o as D,c as F,w as t,e as a,F as G,R as L,C as E,f as r,B as U,g as m,M as $,A as R,h as A,m as I,S as M,i as k,I as f,T as B,j as K,k as H,l as V,t as q,n as Q,D as z,p as W,q as X,E as Y}from "./index.4359b293.js";import{u as Z,a as S,b as ee,c as ae,R as te}from "./http-job.319f7351.js";const oe=C({__name:"HttpJobDelete",props:{groupName:null,jobName:null},setup(v){const n=v,{isLoading:s,mutateAsync:p}=Z(n.groupName,n.jobName);return(d, c)=>w(d.$slots,"default",{isLoading:e(s),mutateAsync:e(p)})}}),le=C({__name:"HttpJobForm",setup(v){const n=O({httpJob:{jobName:"",jobGroup:"",url:"",apiKey:"",apiToken:"",body:"",httpMethod:"GET"},description:"",cronExpression:""}),s=()=>{n.value={httpJob:{jobName:"",jobGroup:"",url:"",apiKey:"",apiToken:"",body:"",httpMethod:"GET"},description:"",cronExpression:""}},{isLoading:p,isError:d,error:c,isSuccess:_,mutateAsync:i}=S(n.value);return(u, y)=>w(u.$slots,"default",{formState:n.value,isLoading:e(p),isError:e(d),error:e(c),isSuccess:e(_),mutateAsync:e(i),resetForm:s})}}),ne=C({__name:"HttpJobGroupList",setup(v){const{isLoading:n,isFetching:s,isError:p,data:d,error:c,refetch:_}=ee();return(i, u)=>w(i.$slots,"default",{isLoading:e(n),isFetching:e(s),isError:e(p),data:e(d),error:e(c),refetch:e(_)})}}),se=C({__name:"HttpJobList",props:{groupName:null},setup(v){const n=v,{isFetching:s,isError:p,data:d,error:c,refetch:_}=ae(n.groupName);return(i, u)=>w(i.$slots,"default",{isFetching:e(s),isError:e(p),data:e(d),error:e(c),refetch:e(_)})}}),ue={style:{margin:"0"}},pe=C({__name:"HttpCrontab",setup(v){const n=P(),s=O(!1),p=async(i, u, y)=>{await i(),await y(),await u(),s.value=!1},d=[{title:"Group Name",dataIndex:"name",key:"name",fixed:!0}],c=(i, u)=>{$.confirm({title:"Do you want to delete this job?",icon:a(Y),content:a("div",{style:"color:red;"},"Deleted job will be permanently removed from the database."),onOk:async()=>{await i(),await u()},onCancel(){}})},_=[{title:"Name",dataIndex:"name",key:"name",fixed:!0},{title:"Cron Expression",dataIndex:"cronExpression",key:"cronExpression",width:"12%"},{title:"Description",dataIndex:"description",key:"description",width:"30%"},{title:"Action",key:"action",width:"20%"}];return(i, u)=>(D(),F(ne,null,{default:t(({isFetching:y,data:N,refetch:x})=>[a(e(X),{direction:"vertical",style:{width:"100%"},size:"small"},{default:t(()=>[a(e(G),{layout:"vertical"},{default:t(()=>[a(e(L),{gutter:24},{default:t(()=>[a(e(E),null,{default:t(()=>[a(e(r),null,{default:t(()=>[a(e(U),{type:"primary",onClick: o=>x(),shape:"circle",loading:y},{icon:t(()=>[a(e(te))]),_:2},1032,["onClick","loading"])]),_:2},1024)]),_:2},1024),a(e(E),null,{default:t(()=>[a(e(r),null,{default:t(()=>[a(e(U),{onClick:u[0]||(u[0]=()=>s.value=!0)},{default:t(()=>[m("Create New")]),_:1})]),_:1})]),_:1})]),_:2},1024)]),_:2},1024),a(le,null,{default:t(({formState:o,mutateAsync:T,resetForm:J,error:b,isError:h})=>[a(e($),{visible:s.value,"onUpdate:visible":u[1]||(u[1]= g=>s.value=g),title:"Add Job",onOk:()=>p(T,J,x)},{default:t(()=>{var g,j;return[h?(D(),F(e(R),{key:0,message:(g=b==null?void 0:b.response)==null?void 0:g.data.error,description:(j=b==null?void 0:b.response)==null?void 0:j.data.message,type:"error",closable:""},null,8,["message","description"])):A("",!0),a(e(G),I({labelCol:{span:5},wrapperCol:{span:19}},{model:o}),{default:t(()=>[a(e(r),{label:"URL"},{default:t(()=>[a(e(L),null,{default:t(()=>[a(e(E),{span:6},{default:t(()=>[a(e(M),{value:o.httpJob.httpMethod,"onUpdate:value": l=>o.httpJob.httpMethod=l},{default:t(()=>[a(e(k),{value:"GET"},{default:t(()=>[m("GET")]),_:1}),a(e(k),{value:"POST"},{default:t(()=>[m("POST")]),_:1}),a(e(k),{value:"PUT"},{default:t(()=>[m("PUT")]),_:1}),a(e(k),{value:"PATCH"},{default:t(()=>[m("PATCH")]),_:1}),a(e(k),{value:"DELETE"},{default:t(()=>[m("DELETE")]),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1024),a(e(E),{span:18},{default:t(()=>[a(e(f),{value:o.httpJob.url,"onUpdate:value": l=>o.httpJob.url=l},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(e(r),{label:"Request Body"},{default:t(()=>[a(e(B),{value:o.httpJob.body,"onUpdate:value": l=>o.httpJob.body=l},null,8,["value","onUpdate:value"])]),_:2},1024),a(e(r),{label:"Username"},{default:t(()=>[a(e(f),{value:o.httpJob.apiKey,"onUpdate:value": l=>o.httpJob.apiKey=l},null,8,["value","onUpdate:value"])]),_:2},1024),a(e(r),{label:"Password"},{default:t(()=>[a(e(K),{value:o.httpJob.apiToken,"onUpdate:value": l=>o.httpJob.apiToken=l},null,8,["value","onUpdate:value"])]),_:2},1024),a(e(r),{label:"Cron"},{default:t(()=>[a(e(f),{value:o.cronExpression,"onUpdate:value": l=>o.cronExpression=l},null,8,["value","onUpdate:value"])]),_:2},1024),a(e(r),{label:"Group"},{default:t(()=>[a(e(f),{value:o.httpJob.jobGroup,"onUpdate:value": l=>o.httpJob.jobGroup=l},null,8,["value","onUpdate:value"])]),_:2},1024),a(e(r),{label:"Name"},{default:t(()=>[a(e(f),{value:o.httpJob.jobName,"onUpdate:value": l=>o.httpJob.jobName=l},null,8,["value","onUpdate:value"])]),_:2},1024),a(e(r),{label:"Description"},{default:t(()=>[a(e(f),{value:o.description,"onUpdate:value": l=>o.description=l},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1040,["model"])]}),_:2},1032,["visible","onOk"])]),_:2},1024),a(e(H),{columns:d,"data-source":N==null?void 0:N.data,loading:y,pagination:{hideOnSinglePage:!0},rowKey:"name"},{expandedRowRender:t(({record:o})=>[V("p",ue,[m(q(o.description)+" ",1),a(se,{"group-name":o.name},{default:t(({isFetching:T,data:J})=>[a(e(H),{columns:_,"data-source":J==null?void 0:J.data,loading:T},{bodyCell:t(({column:b,record:h})=>[b.key==="action"?(D(),Q(W,{key:0},[a(oe,{"group-name":h.groupName,"job-name":h.name},{default:t(({mutateAsync:g})=>[a(e(U),{onClick: j=>c(g,x),danger:""},{icon:t(()=>[a(e(z))]),_:2},1032,["onClick"])]),_:2},1032,["group-name","job-name"]),a(e(U),{onClick:()=>e(n).push(`/logs?groupName=${h.groupName}&jobName=${h.name}`)},{default:t(()=>[m(" Logs ")]),_:2},1032,["onClick"])],64)):A("",!0)]),_:2},1032,["data-source","loading"])]),_:2},1032,["group-name"])])]),_:2},1032,["data-source","loading"])]),_:2},1024)]),_:1}))}});export{pe as default};
